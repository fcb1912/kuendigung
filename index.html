<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>K√ºndigungsformular FC Badenia St. Ilgen</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      color: #333;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 { color: #004080; text-align: center; }
    label { display: block; margin-top: 10px; }
    input, textarea, button {
      width: 100%; padding: 8px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 4px;
    }
    button {
      background: #004080; color: #fff; font-weight: bold;
      cursor: pointer; margin-top: 20px;
    }
    button:hover { background: #0066cc; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>K√ºndigung FC Badenia St. Ilgen</h1>
  <form id="form">
    <label>Vorname: <input name="mitglied_vorname" required></label>
    <label>Nachname: <input name="mitglied_nachname" required></label>
    <label>Geburtsdatum: <input type="date" name="geburtsdatum" id="geburtsdatum" required></label>
    <label>E-Mail: <input type="email" name="email" required></label>
    <label>Mobilnummer: <input name="mobilnummer" required></label>
    <label>K√ºndigungsdatum: <input type="date" name="kuendigungsdatum" required></label>
    <label>Grund: <textarea name="grund"></textarea></label>

    <div id="elternfelder" class="hidden">
      <h3>Erziehungsberechtigte</h3>
      <label>Name Erziehungsberechtigte/r: <input name="eltern_name"></label>
      <label>E-Mail Erziehungsberechtigte/r: <input type="email" name="eltern_email"></label>
    </div>

    <button type="submit">K√ºndigung absenden</button>
  </form>

  <script>
    const geburtsdatumInput = document.getElementById("geburtsdatum");
    const elternfelder = document.getElementById("elternfelder");

    geburtsdatumInput.addEventListener("change", () => {
      const geburtsdatum = new Date(geburtsdatumInput.value);
      const heute = new Date();
      let alter = heute.getFullYear() - geburtsdatum.getFullYear();
      const m = heute.getMonth() - geburtsdatum.getMonth();
      if (m < 0 || (m === 0 && heute.getDate() < geburtsdatum.getDate())) alter--;
      if (alter < 18) {
        elternfelder.classList.remove("hidden");
        elternfelder.querySelectorAll("input").forEach(i => i.required = true);
      } else {
        elternfelder.classList.add("hidden");
        elternfelder.querySelectorAll("input").forEach(i => i.required = false);
      }
    });

    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());

      try {
        console.log("üì§ Sende Daten an Backend:", data);
        const res = await fetch("https://kuendigung.onrender.com/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        console.log("üì• Antwortstatus:", res.status);
        const result = await res.json();
        console.log("üì• Antwortdaten:", result);

        alert(result.message || "Anfrage gesendet.");
      } catch (err) {
        console.error("‚ùå Fehler beim Absenden:", err);
        alert("Fehler beim Absenden. Details siehe Konsole.");
      }
    });
  </script>
</body>
</html>

